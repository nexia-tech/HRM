{% extends 'base.html' %}

{% block title %}
  {{ user1.email }}
{% endblock %}

{% block body %}
  <section class="w-full overflow-hidden dark:bg-gray-900">
    <div class="flex flex-col">
      <!-- Cover Image -->
      <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NzEyNjZ8MHwxfHNlYXJjaHw5fHxjb3ZlcnxlbnwwfDB8fHwxNzEwNzQxNzY0fDA&ixlib=rb-4.0.3&q=80&w=1080" alt="User Cover" class="w-full xl:h-[20rem] lg:h-[18rem] md:h-[16rem] sm:h-[14rem] xs:h-[11rem]" />

      <!-- Profile Image -->
      <div class="sm:w-[80%] xs:w-[90%] mx-auto flex">
        {% if user1.profile_picture %}
          <img src="{{ user1.profile_picture.url }}" alt="User Profile" class="rounded-md lg:w-[12rem] lg:h-[12rem] md:w-[10rem] md:h-[10rem] sm:w-[8rem] sm:h-[8rem] xs:w-[7rem] xs:h-[7rem] outline outline-2 outline-offset-2 outline-blue-500 relative lg:bottom-[5rem] sm:bottom-[4rem] xs:bottom-[3rem]" />
        {% else %}
          <img alt="profile-pic" class="rounded-md lg:w-[12rem] lg:h-[12rem] md:w-[10rem] md:h-[10rem] sm:w-[8rem] sm:h-[8rem] xs:w-[7rem] xs:h-[7rem] outline outline-2 outline-offset-2 outline-blue-500 relative lg:bottom-[5rem] sm:bottom-[4rem] xs:bottom-[3rem]" src="https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg" />
        {% endif %}

        <!-- FullName -->
        <h1 class="w-full text-left my-4 sm:mx-4 xs:pl-4 text-gray-800 dark:text-white lg:text-4xl md:text-3xl sm:text-3xl xs:text-xl font-serif">
          {{ user1.name }} {% if any_field_empty %}
            (<span class="text-red-600">Some Data is Missing</span>)
          {% endif %}
        </h1>
      </div>

      <div class="xl:w-[80%] lg:w-[90%] md:w-[90%] sm:w-[92%] xs:w-[90%] mx-auto flex flex-col gap-4 items-center relative lg:-top-8 md:-top-6 sm:-top-4 xs:-top-4">
        <!-- Description -->

        <!-- Detail -->
        <div class="w-full my-auto py-6 flex flex-col justify-center gap-2">
          <div class="flex justify-between items-center">
            <h1 class="text-4xl text-white font-bold mb-7">Personal Information</h1>
            <button onclick="enableEditMode()" type="button" class="bg-blue-500 hover:bg-blue-700 text-white px-12 py-2 rounded-lg">Edit</button>
            <button id="saveBtn" onclick="saveChanges()" type="button" class="bg-green-500 hover:bg-green-700 text-white px-12 py-2 rounded-lg hidden">Save</button>
            <button id="close" onclick="disabledEditMode()"  type="button" class="bg-blue-500 hover:bg-blue-700 text-white px-12 py-2 rounded-lg hidden">Close</button>
          </div>

          <div class="w-full flex sm:flex-row xs:flex-col gap-2 justify-center">
            <div class="w-full">
              <dl class="text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700">
                <div class="flex flex-col pb-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Full Name</dt>
                  <dd class="text-lg font-semibold">
                    <span id="name">{{ user1.name }}</span>
                    <input type="text" id="nameInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.name }}" />
                  </dd>
                </div>
                <div class="flex flex-col pb-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Employee ID</dt>
                  <dd class="text-lg font-semibold">
                    <span id="employee_id">{{ user1.employee_id }}</span>
                    <input type="text" id="employee_idInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.employee_id }}" />
                  </dd>
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Date Of Birth</dt>
                  <dd class="text-lg font-semibold">
                    <span id="dob">{{ user1.dob }}</span>
                    <input type="date" id="dobInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.dob|date:'Y-m-d' }}" />
                  </dd>
                  
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Marital Status</dt>
                  <dd class="text-lg font-semibold">
                    <dd class="text-lg font-semibold">
                        <span id="martial_status">{{ user1.martial_status }}</span>
                        <input type="text" id="martial_statusInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.martial_status }}" />
                      </dd>
                  </dd>
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Gender</dt>
                  <dd class="text-lg font-semibold">
                    <span id="gender">{{ user1.gender }}</span>
                    <input type="text" id="genderInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.gender }}" />
                  </dd>
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">department</dt>
                  <dd class="text-lg font-semibold">
                    <span id="department">{{ user1.department }}</span>
                    
                    <input type="text" id="departmentInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.department }}" />
                  </dd>
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Password</dt>
                  <dd class="text-lg font-semibold">
                    <span id="active_password">{{ user1.active_password }}</span>
                    
                    <input type="text" id="active_passwordInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.active_password }}" />
                  </dd>
                </div>
              </dl>
            </div>
            <div class="w-full">
              <dl class="text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700">
                <div class="flex flex-col pb-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Address</dt>
                  <dd class="text-lg font-semibold">
                    <span id="address">{{ user1.address }}</span>
                    <input type="text" id="addressInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.address }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Phone Number</dt>
                  <dd class="text-lg font-semibold">
                    <span id="phone">{{ user1.phone }}</span>
                    <input type="text" id="phoneInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.phone }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Email</dt>
                  <dd class="text-lg font-semibold">
                    <span id="email">{{ user1.email }}</span>
                    <input type="text" id="emailInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.email }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">CNIC</dt>
                  <dd class="text-lg font-semibold">
                    <span id="cnic">{{ user1.cnic }}</span>
                    <input type="text" id="cnicInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.cnic }}" />
                  </dd>
                </div>
                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Basic Salary</dt>
                  <dd class="text-lg font-semibold">
                    <span id="basic_salary">{{ user1.basic_salary }}</span>
                    <input type="text" id="basic_salaryInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.basic_salary }}" />
                  </dd>
                </div>
                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">designation</dt>
                  <dd class="text-lg font-semibold">
                    <span id="designation">{{ user1.designation }}</span>
                    <input type="text" id="designationInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.designation }}" />
                  </dd>
                </div>
              </dl>
            </div>

            <div class="w-full">
              <dl class="text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700">
                <div class="flex flex-col pb-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Date of Joining</dt>
                  <dd class="text-lg font-semibold">
                    <span id="doj">{{ user1.doj }}</span>
                    <input type="date" id="dojInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.doj|date:'Y-m-d' }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Emergeny contact number</dt>
                  
                  <dd class="text-lg font-semibold">
                    <span id="emergency_contact_number">{{ user1.emergency_contact_number }}</span>
                    <input type="text" id="emergency_contact_numberInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.emergency_contact_number }}" />
                  </dd>
                </div>

                <div class="flex flex-col py-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Companey Email</dt>
                  
                  <dd class="text-lg font-semibold">
                    <span id="company_email">{{ user1.company_email }}</span>
                    <input type="email" id="company_emailInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.company_email }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Company phone number</dt>
                 
                  <dd class="text-lg font-semibold">
                    <span id="company_phone_number">{{ user1.company_phone_number }}</span>
                    <input type="text" id="company_phone_numberInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.company_phone_number }}" />
                  </dd>
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">Emergeny Contact Relationship?</dt>
                  <dd class="text-lg font-semibold">
                    <span id="emergency_contact_relationship">{{ user1.emergency_contact_relationship }}</span>
                    <input type="text" id="emergency_contact_relationshipInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.emergency_contact_relationship }}" />
                  </dd>
                  
                </div>

                <div class="flex flex-col pt-3">
                  <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400 capitalize">shift timing</dt>
                  <dd class="text-lg font-semibold">
                    <span id="shift_timings">{{ user1.shift_timings }}</span>
                    <input type="time" id="shift_timingsInput" class="hidden bg-white w-full p-2 rounded-md text-black" value="{{ user1.shift_timings|date:'H:i' }}" />
                  </dd>
                  
                </div>
              </dl>
            </div>

            
          </div>
        </div>

        <div class="w-full my-auto py-6">
          <div class="flex justify-between items-center">
            <h1 class="text-4xl text-white font-bold mb-7">Education Information</h1>
          </div>
          <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-lg">
            <thead>
              <tr class="bg-gray-200 text-gray-600 text-left uppercase text-sm leading-normal">
                <th class="py-3 px-6">Institute</th>
                <th class="py-3 px-6">Degree</th>
                <th class="py-3 px-6">Percentage</th>
                <th class="py-3 px-6">Year of Passing</th>
              </tr>
            </thead>
            <tbody id="data-table" class="text-gray-700 text-sm font-light">
              {% if user1.schoool_name %}
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="py-3 px-6">{{ user1.schoool_name }}</td>
                  <td class="py-3 px-6">{{ user1.school_major_subject }}</td>
                  <td class="py-3 px-6">{{ user1.school_grade }}</td>
                  <td class="py-3 px-6">{{ user1.school_year_graduation }}</td>
                </tr>
              {% endif %}
              {% if user1.college_name %}
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="py-3 px-6">{{ user1.college_name }}</td>
                  <td class="py-3 px-6">{{ user1.college_major_subject }}</td>
                  <td class="py-3 px-6">{{ user1.college_grade }}</td>
                  <td class="py-3 px-6">{{ user1.college_year_graduation }}</td>
                </tr>
              {% endif %}
              {% if user1.undergraduate_name %}
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="py-3 px-6">{{ user1.undergraduate_name }}</td>
                  <td class="py-3 px-6">{{ user1.undergraduate_degree }}</td>
                  <td class="py-3 px-6">{{ user1.undergraduate_grade }}</td>
                  <td class="py-3 px-6">{{ user1.undergraduate_graduation_year }}</td>
                </tr>
              {% endif %}

              {% if user1.master_name %}
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="py-3 px-6">{{ user1.master_name }}</td>
                  <td class="py-3 px-6">{{ user1.master_degree }}</td>
                  <td class="py-3 px-6">{{ user1.master_grade }}</td>
                  <td class="py-3 px-6">{{ user1.master_graduation_year }}</td>
                </tr>
              {% endif %}

              {% if user1.phd_name %}
                <tr class="border-b border-gray-200 hover:bg-gray-100">
                  <td class="py-3 px-6">{{ user1.phd_name }}</td>
                  <td class="py-3 px-6">{{ user1.phd_degree }}</td>
                  <td class="py-3 px-6">{{ user1.phd_dissertation }}</td>
                  <td class="py-3 px-6">{{ user1.phd_graduation_year }}</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>

        <div class="w-full my-auto py-6">
          <h1 class="text-4xl text-white font-bold mb-7">Documents Detail</h1>
          <div class="flex items-center space-x-8">
            {% if user1.resume %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.resume.url }}" download="{{ user1.resume }}">Resume</a>
              </p>
              {% else %}
                <p class="text-white">Resume: </p>
                <input type="file" name="" id="">
            {% endif %}
            {% if user1.educational_certificates %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.educational_certificates.url }}" download="{{ user1.educational_certificates }}">Educational Certificates</a>
              </p>
            {% endif %}
            {% if user1.professional_certifications %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.professional_certifications.url }}" download="{{ user1.professional_certifications }}">Professional Certifications</a>
              </p>
            {% endif %}
            {% if user1.offer_letter %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.offer_letter.url }}" download="{{ user1.offer_letter }}">Offer Letter</a>
              </p>
            {% endif %}
            {% if user1.identity_proof %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.identity_proof.url }}" download="{{ user1.identity_proof }}">Identity Proof</a>
              </p>
            {% endif %}
            {% if user1.utility_bills %}
              <p class="text-base text-blue-600 hover:underline font-bold">
                <a href="{{ user1.utility_bills.url }}" download="{{ user1.utility_bills }}">Utility Bills</a>
              </p>
            {% endif %}
          </div>
        </div>
        <!-- Social Links -->
        <div class="fixed right-2 bottom-20 flex flex-col rounded-sm bg-gray-200 text-gray-500 dark:bg-gray-200/80 dark:text-gray-700 hover:text-gray-600 hover:dark:text-gray-400">
          <a href="{{ user1.linkedin_profile }}">
            <div class="p-2 hover:text-primary hover:dark:text-primary">
              <svg class="lg:w-6 lg:h-6 xs:w-4 xs:h-4 text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M12.51 8.796v1.697a3.738 3.738 0 0 1 3.288-1.684c3.455 0 4.202 2.16 4.202 4.97V19.5h-3.2v-5.072c0-1.21-.244-2.766-2.128-2.766-1.827 0-2.139 1.317-2.139 2.676V19.5h-3.19V8.796h3.168ZM7.2 6.106a1.61 1.61 0 0 1-.988 1.483 1.595 1.595 0 0 1-1.743-.348A1.607 1.607 0 0 1 5.6 4.5a1.601 1.601 0 0 1 1.6 1.606Z" clip-rule="evenodd" />
                <path d="M7.2 8.809H4V19.5h3.2V8.809Z" />
              </svg>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal (Single instance outside of the loop) -->
  <div id="mark-as-employee-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-[calc(100%-1rem)] max-h-full flex justify-center items-center">
    <div class="relative p-4 w-full max-w-6xl max-h-full">
      <div class="relative bg-white rounded-lg shadow text-black">
        <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
          <h3 class="text-xl font-semibold text-gray-900">Add as an Employee</h3>
          <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" onclick="closeModal()">
            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
            </svg>
            <span class="sr-only">Close modal</span>
          </button>
        </div>
        <div class="p-4 md:p-5 capitalize space-y-4">
          <div class="mb-5">
            <select name="when_join_us" class="w-full px-4 py-3 rounded-md text-gray-700 font-medium border-solid border-2 border-gray-200 capitalize" required>
              <option value="" disabled selected>Select Status</option>
              <option value="option1">Hired</option>
              <option value="option2">Rejected</option>
              <option value="option3">Follow up</option>
              <option value="option4">Shortlisted</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Photo by '@jessbaileydesigns' & '@von_co' on Unsplash -->
{% endblock %}

{% block script %}
  <script>
    function enableEditMode() {
      document.querySelectorAll('dd span').forEach((span) => span.classList.add('hidden'))
      document.querySelectorAll('dd input').forEach((input) => input.classList.remove('hidden'))
      document.getElementById('saveBtn').classList.remove('hidden')
      document.getElementById('close').classList.remove('hidden')
      
    }
    
    function disabledEditMode() {
        document.querySelectorAll('dd span').forEach((span) => span.classList.remove('hidden'))
        document.querySelectorAll('dd input').forEach((input) => input.classList.add('hidden'))
        document.getElementById('saveBtn').classList.add('hidden')
        document.getElementById('close').classList.add('hidden')
    }


    function saveChanges() {
      const updatedData = {}
      const fields = ['name', 'employee_id', 'dob', 'martial_status', 'gender', 'department','address','phone','email','cnic','basic_salary','designation','doj','emergency_contact_number','company_email','company_phone_number','emergency_contact_relationship','shift_timings','active_password']
    
      fields.forEach((field) => {
        const displaySpan = document.getElementById(field)
        const inputField = document.getElementById(`${field}Input`)
        if (inputField.value !== displaySpan.textContent) {
          updatedData[field] = inputField.value
        }
      })
      let url = "{{BASE_URL}}api/update-user/{{user1.id}}/"
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(updatedData)
      })
        .then((response) => response.json())
        .then((data) => {
          console.log('Update success:', data)
          if (data.success) {
            fields.forEach((field) => {
              document.getElementById(field).textContent = document.getElementById(`${field}Input`).value
            })
            // Hide input fields after saving
            document.querySelectorAll('dd span').forEach((span) => span.classList.remove('hidden'))
            document.querySelectorAll('dd input').forEach((input) => input.classList.add('hidden'))
            document.getElementById('saveBtn').classList.add('hidden')
        document.getElementById('close').classList.add('hidden')
      }
        })
        .catch((error) => console.error('Error updating:', error))
    }
  </script>
{% endblock %}
